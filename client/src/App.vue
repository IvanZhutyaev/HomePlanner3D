<template>
  <div class="page">
    <header v-if="!isAccountPage && !isChatPage && !isConstructorPage" class="hero">
      <div class="hero__topbar">
        <span class="hero__logo"></span>
        <div class="hero__top-actions">
          <button
            type="button"
            class="btn btn--ghost btn--small hero__login-btn"
            @click="handleAccountButtonClick"
          >
            {{ currentUser ? '–ê–∫–∫–∞—É–Ω—Ç' : '–í–æ–π—Ç–∏' }}
          </button>
        </div>
      </div>
      <div class="hero__content">
        <p class="hero__badge">HomePlanner3D ¬∑ —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏</p>
        <h1>
          HomePlanner3D ‚Äî –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ —É–≤–µ—Ä–µ–Ω–Ω–æ, –ª–µ–≥–∞–ª—å–Ω–æ –∏ –Ω–∞–≥–ª—è–¥–Ω–æ
        </h1>
        <p class="hero__subtitle">
          –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –∏–ª–∏ —ç—Å–∫–∏–∑, –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–ª—É—á–∏—Ç–µ 2.5D –ø–ª–∞–Ω, –≤–∏–¥ –æ—Ç
          –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞, –ø—Ä–æ–≤–µ—Ä–∫—É –°–ù–∏–ü–æ–≤. –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–¥–Ω–æ–º –æ–∫–Ω–µ,
          –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏ —Ç–µ—Ö–ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.
        </p>
        <div class="hero__actions">
          <button class="btn btn--primary" @click="scrollToIntake">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–Ω</button>
        </div>
      </div>
      <div class="hero__visual">
        <div class="visual-card">
          <h3>–°—Ü–µ–Ω–∞—Ä–∏–π ¬´–°–µ–º–µ–π–Ω–∞—è 70 –º¬≤¬ª</h3>
          <p>+1 —Å–ø–∞–ª—å–Ω—è ¬∑ +15% –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–≤–µ—Ç–∞</p>
          <div class="visual-card__plan">
            <div class="visual-card__col">
              <span>–î–æ</span>
              <img :src="beforeImageUrl" alt="–î–æ" class="visual-card__img" loading="lazy" />
            </div>
            <div class="visual-card__col">
              <span>–ü–æ—Å–ª–µ</span>
              <img :src="afterImageUrl" alt="–ü–æ—Å–ª–µ" class="visual-card__img" loading="lazy" />
            </div>
          </div>
        </div>
      </div>
    </header>

    <template v-if="!isAccountPage && !isChatPage && !isConstructorPage">
      <section class="intake" id="intake">
      <div class="section-header">
        <h2>–®–∞–≥ 1. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –∫–≤–∞—Ä—Ç–∏—Ä–µ</h2>
        <p>
          –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–ª–∞–Ω ‚Äî —Å–µ—Ä–≤–∏—Å —Å–∞–º –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç
          –¥–∞–Ω–Ω—ã–µ –∏ –ø–µ—Ä–µ–¥–∞—Å—Ç –∏—Ö –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É.
        </p>
        <ul class="intake__hints">
          <li>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç, DWG/DXF –∏–ª–∏ —Ñ–æ—Ç–æ –ø–ª–∞–Ω–∞.</li>
          <li>–£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—ã, –Ω–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã –∏ –º–æ–∫—Ä—ã–µ –∑–æ–Ω—ã.</li>
          <li>–û–ø–∏—à–∏—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –°–ù–∏–ü—ã, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ñ–ö, –ø–æ–∂–µ–ª–∞–Ω–∏—è.</li>
        </ul>
      </div>
      <form class="intake__form" @submit.prevent="handleSubmit">
        <label>
          –ü–ª–∞–Ω –∫–≤–∞—Ä—Ç–∏—Ä—ã (PDF, DWG, DXF, IFC, JPG, PNG)
          <input
            type="file"
            accept=".pdf,.dwg,.dxf,.ifc,.jpg,.jpeg,.png"
            @change="handleFileChange"
            :disabled="recognitionStatus === 'processing'"
          />
          <small v-if="uploadedFileMeta && recognitionStatus !== 'processing'">
            {{ uploadedFileMeta.name }} ¬∑ {{ uploadedFileMeta.size }} ¬∑ {{ uploadedFileMeta.type }}
          </small>
          <small v-else-if="recognitionStatus === 'processing'" class="intake__recognition">
            üîç –†–∞—Å–ø–æ–∑–Ω–∞—ë–º –ø–ª–∞–Ω... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.
          </small>
          <small v-else>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª, —á—Ç–æ–±—ã –º—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–ª–∏ –ø–ª–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</small>
          <small v-if="fileError" class="intake__error">{{ fileError }}</small>
          <small v-if="recognitionStatus === 'success'" class="intake__success">
            ‚úÖ –ü–ª–∞–Ω —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω —É—Å–ø–µ—à–Ω–æ! –ì–µ–æ–º–µ—Ç—Ä–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
            <button type="button" @click="enableManualEdit" class="intake__edit-btn">
              –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
            </button>
          </small>
          <small v-if="recognitionStatus === 'error'" class="intake__error">
            ‚ö†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é.
          </small>
        </label>
        <label>
          –ê–¥—Ä–µ—Å –∫–≤–∞—Ä—Ç–∏—Ä—ã / –†–µ–≥–∏–æ–Ω
          <input
            v-model="formData.address"
            type="text"
            placeholder="–ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1"
          />
          <small>–ù—É–∂–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –Ω–æ—Ä–º –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –ë–¢–ò.</small>
        </label>
        <label>
          –ü–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä—ã, –º¬≤
          <input v-model="formData.area" type="number" step="0.1" min="10" max="500" />
          <small>–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä—ã –∏–∑ —Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç–∞.</small>
        </label>
        <label>
          –û—Ç–∫—É–¥–∞ –¥–æ–∫—É–º–µ–Ω—Ç?
          <select v-model="formData.planType">
            <option v-for="source in planSources" :key="source" :value="source">
              {{ source }}
            </option>
          </select>
          <small>–ù–∞–ø—Ä–∏–º–µ—Ä, ¬´PDF –∏–∑ –ë–¢–ò¬ª –∏–ª–∏ ¬´–§–æ—Ç–æ —ç—Å–∫–∏–∑–∞¬ª.</small>
        </label>
        <label>
          –¢–∏–ø –∫–≤–∞—Ä—Ç–∏—Ä—ã
          <select v-model="formData.layoutType">
            <option v-for="type in layoutTypes" :key="type" :value="type">
              {{ type }}
            </option>
          </select>
          <small>–ù—É–∂–Ω–æ –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.</small>
        </label>
        <label>
          –í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–æ–≤, –º
          <input v-model="formData.ceilingHeight" type="number" step="0.1" />
          <small>–ü–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å 3D-—Å—Ü–µ–Ω—É. –ï—Å–ª–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ, –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º.</small>
        </label>
        <label>
          –ü–µ—Ä–µ–ø–∞–¥ –ø–æ–ª–∞, —Å–º
          <input v-model="formData.floorDelta" type="number" step="0.5" />
          <small>–ï—Å–ª–∏ —É—Ä–æ–≤–Ω–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ, –æ—Å—Ç–∞–≤—å—Ç–µ 0.</small>
        </label>
        <div v-if="recognitionStatus === 'error' || recognitionStatus === 'success' || manualEditMode" class="intake__geometry-section">
          <h3 class="intake__section-title">
            {{ recognitionStatus === 'success' && !manualEditMode ? '–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è –ø–ª–∞–Ω–∞ (–º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)' : '–ì–µ–æ–º–µ—Ç—Ä–∏—è –ø–ª–∞–Ω–∞ (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é)' }}
          </h3>
          <label class="intake__wide">
            –ö–æ–Ω—Ç—É—Ä—ã –∫–æ–º–Ω–∞—Ç
            <textarea
              v-model="formData.roomsText"
              rows="4"
              placeholder="–ì–æ—Å—Ç–∏–Ω–∞—è:0,0;5.2,0;5.2,4.1;0,4.1"
            ></textarea>
            <small>–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–µ–∫. –§–æ—Ä–º–∞—Ç: –ö–æ–º–Ω–∞—Ç–∞:x1,y1;x2,y2;x3,y3...</small>
          </label>
          <label class="intake__wide">
            –°—Ç–µ–Ω—ã –∏ –∏—Ö —Ç–∏–ø
            <textarea
              v-model="formData.wallsText"
              rows="4"
              placeholder="0,0 -> 5.2,0; –Ω–µ—Å—É—â–∞—è; 0.2"
            ></textarea>
            <small>–ü–æ –æ–¥–Ω–æ–π —Å—Ç–µ–Ω–µ –≤ —Å—Ç—Ä–æ–∫–µ. –§–æ—Ä–º–∞—Ç: x1,y1 -> x2,y2; —Ç–∏–ø; —Ç–æ–ª—â–∏–Ω–∞</small>
          </label>
        </div>
        <label class="intake__wide">
          –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
          <textarea
            v-model="formData.constraintsText"
            rows="3"
            placeholder="–Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –∫—É—Ö–Ω—é –Ω–∞–¥ –∂–∏–ª–æ–π&#10;—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–µ–Ω—Ç—à–∞—Ö—Ç—É"
          ></textarea>
          <small>–í—Å–µ –ø—Ä–∞–≤–∏–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å (–°–ù–∏–ü—ã, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ñ–ö).</small>
        </label>
        <label class="intake__wide">
          –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–æ—Ä–º—ã / –¥–æ–∫—É–º–µ–Ω—Ç—ã
          <input
            v-model="formData.regionRules"
            type="text"
            placeholder="–°–ù–∏–ü 31-02; –ñ–ö –†–§ —Å—Ç.25"
          />
          <small>–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–∞–ª–∞—Å—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.</small>
        </label>
        <label>
          –ö—Ç–æ –±—É–¥–µ—Ç –∂–∏—Ç—å?
          <select v-model="formData.familyProfile">
            <option v-for="profile in familyProfiles" :key="profile" :value="profile">
              {{ profile }}
            </option>
          </select>
          <small>–í–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫—É –º–µ–±–µ–ª–∏.</small>
        </label>
        <label>
          –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å
          <input
            v-model="formData.goal"
            type="text"
            placeholder="–î–æ–±–∞–≤–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç, –±–æ–ª—å—à–µ —Å–≤–µ—Ç–∞, —Å–¥–∞—á–∞ –≤ –∞—Ä–µ–Ω–¥—É"
          />
          <small>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–æ –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.</small>
        </label>
        <label class="intake__wide">
          –ñ–µ–ª–∞–Ω–∏—è –ø–æ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ
          <textarea
            v-model="formData.prompt"
            rows="4"
            placeholder="–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∫—É—Ö–Ω—é –∏ –≥–æ—Å—Ç–∏–Ω—É—é, –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–≤–µ—Ä—å –≤ —Å–ø–∞–ª—å–Ω—é, –¥–æ–±–∞–≤–∏—Ç—å –≥–∞—Ä–¥–µ—Ä–æ–±–Ω—É—é."
          ></textarea>
          <small>–û–ø–∏—à–∏—Ç–µ —Å–ª–æ–≤–∞–º–∏, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å. –≠—Ç–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.</small>
        </label>
        <div class="intake__actions">
          <button type="submit" class="btn btn--primary btn--small" :disabled="isSubmitting">
            {{ isSubmitting ? '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É' }}
          </button>
        </div>
        <p v-if="submitStatus" class="intake__status">{{ submitStatus }}</p>
      </form>
    </section>

    <section class="flow">
      <h2>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
      <p class="flow__subtitle">
        –ß–µ—Ç—ã—Ä–µ —à–∞–≥–∞ –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç–∞ –¥–æ –∑–∞—è–≤–∫–∏ –≤ –ë–¢–ò: —Ä–∞—Å–ø–æ–∑–Ω–∞—ë–º, –¥–∞—ë–º
        –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º —ç–∫—Å–ø–µ—Ä—Ç–æ–≤.
      </p>
      <div class="flow__steps">
        <article v-for="(step, index) in steps" :key="step.title" class="step">
          <div class="step__number">{{ index + 1 }}</div>
          <h3>{{ step.title }}</h3>
          <p>{{ step.description }}</p>
          <a class="step__link" href="#" @click.prevent="openFlowModal(index)">–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ</a>
        </article>
      </div>
    </section>

    <div v-if="isFlowModalOpen" class="modal-backdrop" @click.self="closeFlowModal">
      <div class="modal">
        <div class="modal__header">
          <h3>{{ steps[activeFlowStep]?.title }}</h3>
          <button type="button" class="modal__close" @click="closeFlowModal">√ó</button>
        </div>
        <div class="modal__body">
          <p class="flow-modal__lead">{{ steps[activeFlowStep]?.description }}</p>
          <ul class="flow-modal__list">
            <li v-for="detail in steps[activeFlowStep]?.details" :key="detail">{{ detail }}</li>
          </ul>
        </div>
      </div>
    </div>

    <section class="recognition">
      <div class="recognition__text">
        <h2>–†–∞—Å–ø–æ–∑–Ω–∞—ë–º –ø–ª–∞–Ω—ã –ª—é–±–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h2>
        <p>
          –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º PDF, —Ñ–æ—Ç–æ —Å–æ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞ –∏ BIM-—Ñ–∞–π–ª—ã. –ê–ª–≥–æ—Ä–∏—Ç–º —á–∏—Å—Ç–∏—Ç —à—É–º,
          –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–º–µ—â–µ–Ω–∏—è –∏ –º–µ–±–µ–ª—å, –¥–æ—Å—Ç–∏–≥–∞—è –¥–æ 94% —Ç–æ—á–Ω–æ—Å—Ç–∏.
        </p>
        <ul>
          <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–µ–Ω, –¥–≤–µ—Ä–µ–π –∏ –º–æ–∫—Ä—ã—Ö –∑–æ–Ω</li>
          <li>–≠–∫—Å–ø–æ—Ä—Ç –≤ DWG, SVG –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π 3D</li>
          <li>–ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π –∏ —Å–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–æ–º</li>
        </ul>
        <button class="btn btn--primary btn--small" @click="openCaseModal">
          –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π –∫–µ–π—Å
        </button>
      </div>
      <div class="recognition__preview">
        <div class="preview-card">
          <p>–î–æ</p>
          <img :src="beforeImageUrl" alt="–î–æ" class="preview-card__img" loading="lazy" />
        </div>
        <div class="preview-card">
          <p>–ü–æ—Å–ª–µ</p>
          <img :src="afterImageUrl" alt="–ü–æ—Å–ª–µ" class="preview-card__img" loading="lazy" />
        </div>
      </div>
    </section>

    <div v-if="isCaseModalOpen" class="modal-backdrop" @click.self="closeCaseModal">
      <div class="modal">
        <div class="modal__header">
          <h3>–ü–æ–ª–Ω—ã–π –∫–µ–π—Å HomePlanner3D</h3>
          <button type="button" class="modal__close" @click="closeCaseModal">√ó</button>
        </div>
        <div class="modal__body case-modal">
          <div class="case-modal__section">
            <h4>–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ</h4>
            <ul class="case-modal__list">
              <li>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç–∞ –∏–ª–∏ —Ñ–æ—Ç–æ –ø–ª–∞–Ω–∞ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫</li>
              <li>–ê–≤—Ç–æ—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω, –∫–æ–º–Ω–∞—Ç –∏ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç–æ–∫</li>
              <li>–ë—ã—Å—Ç—Ä—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: —Å–Ω–æ—Å/–ø–µ—Ä–µ–Ω–æ—Å —Å—Ç–µ–Ω, –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏, –±–∞–∑–æ–≤–∞—è –º–µ–±–µ–ª—å</li>
              <li>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è: —Ç–æ—á–Ω—ã–π –ø–ª–∞–Ω —Å–≤–µ—Ä—Ö—É –∏ –ø—Ä–æ–≥—É–ª–∫–∞ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞</li>
              <li>–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º: –Ω–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã, –º–æ–∫—Ä—ã–µ –∑–æ–Ω—ã, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è, –ø–æ–∂–∞—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è</li>
              <li>–≠–∫—Å–ø–æ—Ä—Ç –∏ –∑–∞—è–≤–∫–∞: DWG/SVG/3D –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–¢–ò</li>
            </ul>
          </div>

          <div class="case-modal__section">
            <h4>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h4>
            <ul class="case-modal__list">
              <li>–ó–∞–≥—Ä—É–∂–∞–µ—Ç–µ –ø–ª–∞–Ω –∫–≤–∞—Ä—Ç–∏—Ä—ã</li>
              <li>–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –≥–µ–æ–º–µ—Ç—Ä–∏—é –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
              <li>–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç–µ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ 2.5D/FPV</li>
              <li>–ü–æ–ª—É—á–∞–µ—Ç–µ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–æ—Ä–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –æ—Ç—á—ë—Ç</li>
              <li>–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –∑–∞—è–≤–∫—É –∏ –ø–æ–ª—É—á–∞–µ—Ç–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤</li>
            </ul>
          </div>

          <div class="case-modal__section">
            <h4>–î–ª—è –∫–æ–≥–æ</h4>
            <ul class="case-modal__list">
              <li>–í–ª–∞–¥–µ–ª—å—Ü—ã –∫–≤–∞—Ä—Ç–∏—Ä, —Å–µ–º—å–∏, –∏–Ω–≤–µ—Å—Ç–æ—Ä—ã</li>
              <li>–î–∏–∑–∞–π–Ω–µ—Ä—ã –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—ã</li>
              <li>–î–µ–≤–µ–ª–æ–ø–µ—Ä—ã –∏ —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <section class="builder">
      <div class="section-header">
        <h2>–ò–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä HomePlanner3D</h2>
        <p>
          –†–µ–¥–∞–∫—Ç–æ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 2.5D –ø–ª–∞–Ω –∏ –ø—Ä–æ–≥—É–ª–∫—É –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞. –ú–æ–∂–Ω–æ —Å–Ω–æ—Å–∏—Ç—å
          —Å—Ç–µ–Ω—ã, —Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –∏ —Ä–∞—Å—Å—Ç–∞–≤–ª—è—Ç—å –±–∞–∑–æ–≤—É—é –º–µ–±–µ–ª—å, —Å–æ—Ö—Ä–∞–Ω—è—è —Ç–æ—á–Ω—ã–µ
          —Ä–∞–∑–º–µ—Ä—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã.
        </p>
      </div>
      <div class="builder__grid">
        <article
          v-for="tool in builderTools"
          :key="tool.title"
          class="builder-card"
        >
          <h3>{{ tool.title }}</h3>
          <p>{{ tool.description }}</p>
        </article>
      </div>
      <div class="builder__modes">
        <article v-for="mode in builderModes" :key="mode.title" class="mode-card">
          <h3>{{ mode.title }}</h3>
          <p>{{ mode.description }}</p>
        </article>
      </div>
    </section>

    <section class="editor-cta">
      <div class="editor-cta__card">
        <div class="editor-cta__text">
          <h2>–ò–≥—Ä–æ–≤–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏</h2>
          <p>
            –í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 2D‚Äë–ø–ª–∞–Ω –∏ 3D‚Äë–≤–∏–¥. –ú–æ–∂–Ω–æ —Å–Ω–æ—Å–∏—Ç—å –∏ –¥–æ–±–∞–≤–ª—è—Ç—å —Å—Ç–µ–Ω—ã,
            —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–º–µ—â–µ–Ω–∏—è –∏ —Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞.
          </p>
        </div>
        <div class="editor-cta__actions">
          <button class="btn btn--primary" @click="goToConstructor">–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä</button>
        </div>
      </div>
    </section>

    <section class="checks">
      <div class="section-header">
        <h2>–ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º –∏ —Ä–∏—Å–∫–æ–≤</h2>
        <p>
          –ö–∞–∂–¥—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–æ—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞: –Ω–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã,
          –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è, –ø–µ—Ä–µ–Ω–æ—Å –º–æ–∫—Ä—ã—Ö –∑–æ–Ω –∏ –ø–æ–∂–∞—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.
        </p>
      </div>
      <div class="checks__list">
        <article v-for="check in checks" :key="check.title" class="check-card">
          <div class="status" :class="`status--${check.status}`">
            {{ check.statusLabel }}
          </div>
          <h3>{{ check.title }}</h3>
          <p>{{ check.description }}</p>
        </article>
      </div>
      <button class="btn btn--ghost" @click="openNormsReport">–ü–æ–ª—É—á–∏—Ç—å –æ—Ç—á—ë—Ç –ø–æ –Ω–æ—Ä–º–∞–º</button>
    </section>

    <div v-if="isNormsModalOpen" class="modal-backdrop" @click.self="closeNormsModal">
      <div class="modal">
        <div class="modal__header">
          <h3>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –Ω–æ—Ä–º–∞–º</h3>
          <button type="button" class="modal__close" @click="closeNormsModal">√ó</button>
        </div>
        <div class="modal__body report-modal">
          <p v-if="isGeneratingReport">–§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á—ë—Ç‚Ä¶</p>
          <pre v-else class="report-modal__text">{{ normsReportText }}</pre>
        </div>
      </div>
    </div>

    <section class="demo">
      <div class="demo__media">
        <img :src="demoImageUrl" alt="–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–≤–∞—Ä—Ç–∏—Ä—ã" class="demo__img" loading="lazy" />
      </div>
      <div class="demo__content">
        <h2>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è 3D –∏ AR –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</h2>
        <p>
          –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ –º–µ–Ω—è—é—Ç—Å—è —Å—Ç–µ–Ω—ã –∏ –º–µ–±–µ–ª—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –î–µ–ª–∏—Ç–µ—Å—å
          —Ä–µ–∂–∏–º–æ–º —Å–≤–µ—Ä—Ö—É –∏ –ø—Ä–æ–≥—É–ª–∫–æ–π –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞ —Å —Å–µ–º—å—ë–π –∏–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–æ–º,
          –æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –ø—Ä–∞–≤–∫–∏.
        </p>
        <button class="btn btn--primary" @click="scrollToIntake">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–µ–º–æ</button>
      </div>
    </section>

    <section class="testimonials">
      <h2>–ù–∞–º –¥–æ–≤–µ—Ä—è—é—Ç –º–∞—Å—Ç–µ—Ä–∞ –∏ –∂–∏–ª—å—Ü—ã</h2>
      <div class="testimonials__list">
        <article
          v-for="testimonial in testimonials"
          :key="testimonial.author"
          class="testimonial-card"
        >
          <p class="testimonial-card__text">"{{ testimonial.quote }}"</p>
          <p class="testimonial-card__author">
            {{ testimonial.author }} ¬∑ {{ testimonial.type }}
          </p>
        </article>
      </div>
    </section>

    <section class="experts">
      <div class="experts__content">
        <h2>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –ë–¢–ò</h2>
        <p>
          –ö–æ–≥–¥–∞ —Å—Ü–µ–Ω–∞—Ä–∏–π —É—Å—Ç—Ä–æ–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ—à—ë–ª –ø—Ä–æ–≤–µ—Ä–∫–∏, –æ–Ω –æ—Å—Ç–∞–≤–ª—è–µ—Ç
          –∑–∞—è–≤–∫—É –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –≤—ã–µ–∑–¥ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞. –ú—ã –ø–µ—Ä–µ–¥–∞—ë–º –≤–µ—Å—å
          –ø–∞–∫–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∏ —á–µ—Ä—Ç–µ–∂–µ–π –≤ –ë–¢–ò –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞.
        </p>
        <ul>
          <li v-for="channel in expertChannels" :key="channel">
            {{ channel }}
          </li>
        </ul>
      </div>
      <form class="experts__form">
        <label>
          –ò–º—è –∏ –≥–æ—Ä–æ–¥
          <input v-model="expertsForm.nameCity" type="text" placeholder="–ú–∞—Ä–∏—è, –ú–æ—Å–∫–≤–∞" />
          <small class="field-hint">–§–æ—Ä–º–∞—Ç: –ò–º—è, –ì–æ—Ä–æ–¥. –ù–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω–Ω–∞-–ú–∞—Ä–∏—è, –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥.</small>
          <small v-if="expertErrors.nameCity" class="field-error">{{ expertErrors.nameCity }}</small>
        </label>
        <label>
          –ö–æ–Ω—Ç–∞–∫—Ç
          <input v-model="expertsForm.contact" type="text" placeholder="@telegram –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω" />
          <small class="field-hint">Telegram: @username –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω: +7 916 123-45-67</small>
          <small v-if="expertErrors.contact" class="field-error">{{ expertErrors.contact }}</small>
        </label>
        <label>
          –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
          <textarea v-model="expertsForm.comment" placeholder="–ö–≤–∞—Ä—Ç–∏—Ä–∞ 62 –º¬≤, –Ω—É–∂–µ–Ω –ø—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏"></textarea>
          <small class="field-hint">–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É. –ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ü–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ 70 –º¬≤, —É–≤–µ–ª–∏—á–∏—Ç—å –∫—É—Ö–Ω—é‚Äë–≥–æ—Å—Ç–∏–Ω—É—é¬ª.</small>
          <small v-if="expertErrors.comment" class="field-error">{{ expertErrors.comment }}</small>
        </label>
        <button type="button" class="btn btn--primary" @click="submitExpertRequest" :disabled="!canSubmitExpert">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        <p v-if="expertSubmitStatus" class="experts__status">{{ expertSubmitStatus }}</p>
      </form>
    </section>

    <section class="faq">
      <div class="section-header">
        <h2>–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</h2>
        <p>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ–º –æ —Å—Ä–æ–∫–∞—Ö, –ø—Ä–∞–≤–∞—Ö –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.</p>
      </div>
      <div class="faq__list">
        <article v-for="item in faq" :key="item.question" class="faq-card">
          <h3>{{ item.question }}</h3>
          <p>{{ item.answer }}</p>
        </article>
      </div>
      <div class="faq__actions">
        <button class="btn btn--ghost" @click="downloadGuide">–°–∫–∞—á–∞—Ç—å –≥–∏–¥ –ø–æ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ</button>
        <button class="btn btn--primary btn--small" @click="goToChat">–ß–∞—Ç —Å —ç–∫—Å–ø–µ—Ä—Ç–æ–º</button>
      </div>
    </section>

    <footer class="footer">
      <div>
        <p class="footer__brand">HomePlanner3D ‚Äî –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–µ–º–æ–Ω—Ç–∞</p>
        <p>–¶–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏: —Ä–∞—Å–ø–æ–∑–Ω–∞—ë–º –ø–ª–∞–Ω—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ—Ä–º—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±—É–¥—É—â–µ–µ –∂–∏–ª—å—ë.</p>
      </div>
      <div class="footer__links">
        <a href="#" @click.prevent="openContacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        <a href="#" @click.prevent="openTelegram">Telegram</a>
        <a href="#" @click.prevent="openPolicy">–ü–æ–ª–∏—Ç–∏–∫–∞</a>
      </div>
    </footer>
    </template>

    <AccountPage
      v-else-if="isAccountPage"
      :user="currentUser"
      :format-birthday="formatBirthday"
      @back="goToLanding"
      @open-auth="openAuthFromAccountPage"
      @logout="handleLogout"
    />

    <ConstructorPage v-else-if="isConstructorPage" @back="goToLandingFromConstructor" />

    <ChatPage v-else @back="goToLandingFromChat" />

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ / —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div v-if="isAuthModalOpen" class="modal-backdrop" @click.self="isAuthModalOpen = false">
      <div class="modal">
        <div class="modal__header">
          <h3 v-if="!currentUser">
            {{ authMode === 'login' ? '–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' }}
          </h3>
          <h3 v-else>–ü—Ä–æ—Ñ–∏–ª—å</h3>
          <button type="button" class="modal__close" @click="isAuthModalOpen = false">√ó</button>
        </div>

        <div v-if="!currentUser" class="modal__body">
          <div class="account__tabs">
            <button
              type="button"
              :class="['account__tab', authMode === 'login' && 'account__tab--active']"
              @click="authMode = 'login'"
            >
              –í–æ–π—Ç–∏
            </button>
            <button
              type="button"
              :class="['account__tab', authMode === 'register' && 'account__tab--active']"
              @click="authMode = 'register'"
            >
              –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            </button>
          </div>

          <form class="account__form" @submit.prevent="handleAuthSubmit">
            <label>
              ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è / –ª–æ–≥–∏–Ω
              <input
                v-model="authForm.login"
                type="text"
                autocomplete="username"
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 1"
                required
              />
              <small class="account__hint">
                –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ API getUser(id: ID!)
              </small>
            </label>
            <label>
              –ü–∞—Ä–æ–ª—å
              <input
                v-model="authForm.password"
                type="password"
                autocomplete="current-password"
                required
              />
            </label>
            <label v-if="authMode === 'register'">
              –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
              <input
                v-model="authForm.username"
                type="text"
                placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è"
              />
            </label>
            <label v-if="authMode === 'register'">
              Email
              <input
                v-model="authForm.email"
                type="email"
                placeholder="name@example.com"
              />
            </label>
            <label v-if="authMode === 'register'">
              –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
              <input
                v-model="authForm.birthday"
                type="date"
              />
            </label>

            <div class="account__actions">
              <button
                type="submit"
                class="btn btn--primary btn--small"
                :disabled="authLoading"
              >
                {{ authLoading
                  ? (authMode === 'login' ? '–í—Ö–æ–¥–∏–º‚Ä¶' : '–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º‚Ä¶')
                  : (authMode === 'login' ? '–í–æ–π—Ç–∏' : '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è') }}
              </button>
              <p v-if="authError" class="account__error">
                {{ authError }}
              </p>
            </div>
          </form>
        </div>

        <div v-else class="modal__body account__profile">
          <div class="account__card">
            <p><strong>–õ–æ–≥–∏–Ω:</strong> {{ currentUser.login }}</p>
            <p v-if="currentUser.username"><strong>–ò–º—è:</strong> {{ currentUser.username }}</p>
            <p v-if="currentUser.email"><strong>Email:</strong> {{ currentUser.email }}</p>
            <p v-if="currentUser.birthday"><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ formatBirthday(currentUser.birthday) }}</p>
          </div>
          <div class="account__actions">
            <button type="button" class="btn btn--ghost btn--small" @click="logout">
              –í—ã–π—Ç–∏
            </button>
          </div>
        </div>
      </div>
    </div>

    <div v-if="isContactsOpen" class="modal-backdrop" @click.self="closeContacts">
      <div class="modal">
        <div class="modal__header">
          <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
          <button type="button" class="modal__close" @click="closeContacts">√ó</button>
        </div>
        <div class="modal__body">
          <p>Telegram: @homeplanner3d</p>
          <p>Email: info@homeplanner3d.example</p>
          <div style="margin-top: 8px; display: flex; gap: 8px;">
            <button type="button" class="btn btn--primary btn--small" @click="openTelegramExternal">–û—Ç–∫—Ä—ã—Ç—å Telegram</button>
            <button type="button" class="btn btn--ghost btn--small" @click="closeContacts">–ó–∞–∫—Ä—ã—Ç—å</button>
          </div>
        </div>
      </div>
    </div>

    <div v-if="isTelegramOpen" class="modal-backdrop" @click.self="closeTelegram">
      <div class="modal">
        <div class="modal__header">
          <h3>Telegram</h3>
          <button type="button" class="modal__close" @click="closeTelegram">√ó</button>
        </div>
        <div class="modal__body">
          <p>–ù–∞—à –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª: @homeplanner3d</p>
          <div style="margin-top: 8px; display: flex; gap: 8px;">
            <button type="button" class="btn btn--primary btn--small" @click="openTelegramExternal">–û—Ç–∫—Ä—ã—Ç—å Telegram</button>
            <button type="button" class="btn btn--ghost btn--small" @click="closeTelegram">–ó–∞–∫—Ä—ã—Ç—å</button>
          </div>
        </div>
      </div>
    </div>

    <div v-if="isPolicyOpen" class="modal-backdrop" @click.self="closePolicy">
      <div class="modal">
        <div class="modal__header">
          <h3>–ü–æ–ª–∏—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
          <button type="button" class="modal__close" @click="closePolicy">√ó</button>
        </div>
        <div class="modal__body">
          <p>–ú—ã –±–µ—Ä–µ–∂–Ω–æ –æ—Ç–Ω–æ—Å–∏–º—Å—è –∫ –≤–∞—à–∏–º –¥–∞–Ω–Ω—ã–º: –∏—Å–ø–æ–ª—å–∑—É–µ–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ –∑–∞–ø—Ä–æ—Å—É.</p>
          <p>–î–∞–Ω–Ω—ã–µ –∏–∑ –ø–ª–∞–Ω–æ–≤ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π.</p>
          <div style="margin-top: 8px; display: flex; gap: 8px;">
            <button type="button" class="btn btn--ghost btn--small" @click="closePolicy">–ó–∞–∫—Ä—ã—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { reactive, ref, onMounted, computed } from 'vue';
import { graphqlRequest, CREATE_PLANNING_PROJECT_MUTATION } from './utils/graphqlClient.js';
import ConstructorPage from './pages/ConstructorPage.vue';
import AccountPage from './pages/AccountPage.vue';
import ChatPage from './pages/ChatPage.vue';
import beforeImageUrl from './assets/–°—Ü–µ–Ω–∞—Ä–∏–π ¬´–°–µ–º–µ–π–Ω–∞—è 70 –º¬≤¬ª–î–û.png';
import afterImageUrl from './assets/–°—Ü–µ–Ω–∞—Ä–∏–π ¬´–°–µ–º–µ–π–Ω–∞—è 70 –º¬≤¬ª–ü–û–°–õ–ï.png';
import demoImageUrl from './assets/–í–µ—Ä—Ç–ö–≤–∞—Ä.png';

const scrollToSection = (id) => {
  try {
    const el = typeof document !== 'undefined' ? document.getElementById(id) : null;
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  } catch {}
};

const scrollToIntake = () => scrollToSection('intake');
const isFlowModalOpen = ref(false);
const activeFlowStep = ref(null);
const openFlowModal = (index) => {
  activeFlowStep.value = index;
  isFlowModalOpen.value = true;
};
const closeFlowModal = () => {
  isFlowModalOpen.value = false;
  activeFlowStep.value = null;
};
const isCaseModalOpen = ref(false);
const openCaseModal = () => {
  isCaseModalOpen.value = true;
};
const closeCaseModal = () => {
  isCaseModalOpen.value = false;
};
const isNormsModalOpen = ref(false);
const isGeneratingReport = ref(false);
const normsReportText = ref('');
const closeNormsModal = () => {
  isNormsModalOpen.value = false;
  normsReportText.value = '';
};

const buildLocalNormsReport = (payload) => {
  const p = payload || {};
  const plan = p.plan || {};
  const address = plan.address || '‚Äî';
  const area = plan.area ? `${plan.area} –º¬≤` : '‚Äî';
  const layoutType = plan.layoutType || '‚Äî';
  const ceiling = plan.ceilingHeight ? `${plan.ceilingHeight} –º` : '‚Äî';
  const roomsCount = (p.geometry?.rooms || []).length;
  const wallsCount = (p.walls || []).length;
  const userConstraints = p.constraints?.forbiddenMoves || parseConstraints();

  const sections = [];
  sections.push([
    '–°–≤–æ–¥–∫–∞ –æ–±—ä–µ–∫—Ç–∞',
    `–ê–¥—Ä–µ—Å: ${address}`,
    `–ü–ª–æ—â–∞–¥—å: ${area}`,
    `–¢–∏–ø –∫–≤–∞—Ä—Ç–∏—Ä—ã: ${layoutType}`,
    `–í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–æ–≤: ${ceiling}`,
    `–ö–æ–º–Ω–∞—Ç (–ø–æ –≥–µ–æ–º–µ—Ç—Ä–∏–∏): ${roomsCount}`,
    `–°—Ç–µ–Ω—ã: ${wallsCount}`,
  ].join('\n'));

  const statusLines = checks.map((c) => `- ${c.title}: ${c.statusLabel} ‚Äî ${c.description}`);
  sections.push(['–°—Ç–∞—Ç—É—Å—ã –ø—Ä–æ–≤–µ—Ä–æ–∫', ...statusLines].join('\n'));

  sections.push([
    '–ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è',
    '‚Ä¢ –ù–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã: –ø—Ä–æ—ë–º—ã —Ç–æ–ª—å–∫–æ —Å –ø—Ä–æ–µ–∫—Ç–Ω—ã–º —É—Å–∏–ª–µ–Ω–∏–µ–º (–ø–µ—Ä–µ–º—ã—á–∫–∞/—Ä–∞–º–∞).',
    '‚Ä¢ –ú–æ–∫—Ä—ã–µ –∑–æ–Ω—ã: –ø–µ—Ä–µ–Ω–æ—Å –∫—É—Ö–Ω–∏/—Å–∞–Ω—É–∑–ª–∞ –Ω–∞–¥ –∂–∏–ª—ã–º–∏ ‚Äî –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.',
    '‚Ä¢ –í–µ–Ω—Ç–∏–ª—è—Ü–∏—è: —à–∞—Ö—Ç—ã –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å; –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –±–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞.',
    '‚Ä¢ –ü–æ–∂–∞—Ä–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ö–æ–¥ —ç–≤–∞–∫—É–∞—Ü–∏–∏ ‚â• 0.9 –º; –¥–≤–µ—Ä–∏ –º–æ–∫—Ä—ã—Ö –∑–æ–Ω ‚â• 0.7 –º.',
  ].join('\n'));

  sections.push([
    '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏',
    '‚Ä¢ –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –≥—Ä–∞–Ω–∏—Ü—ã –º–æ–∫—Ä—ã—Ö –∑–æ–Ω –∏ —Ç—Ä–∞—Å—Å—ã –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏.',
    '‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–ø –∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ—Å—É—â–∏—Ö —Å—Ç–µ–Ω –ø–æ —Å–µ—Ä–∏–∏ –¥–æ–º–∞/—Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç—É.',
    '‚Ä¢ –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–µ—Å—É—â–∏—Ö/–º–æ–∫—Ä—ã—Ö –∑–æ–Ω ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –ø—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è –ë–¢–ò.',
  ].join('\n'));

  const nextSteps = [
    '1) –£—Ç–æ—á–Ω–∏—Ç—å –∞–¥—Ä–µ—Å, —ç—Ç–∞–∂ –∏ —Å–µ—Ä–∏—é –¥–æ–º–∞.',
    '2) –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç: –ø–ª–∞–Ω –î–û/–ü–û–°–õ–ï, —ç–∫—Å–ø–ª–∏–∫–∞—Ü–∏—è, –ø–æ—ç—Ç–∞–∂–Ω—ã–π –ø–ª–∞–Ω.',
    '3) –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É: –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∞ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ.',
  ];
  sections.push(['–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏', ...nextSteps].join('\n'));

  if (userConstraints?.length) {
    sections.push(['–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', ...userConstraints.map((r) => `- ${r}`)].join('\n'));
  }

  return sections.join('\n\n');
};

const openNormsReport = async () => {
  isNormsModalOpen.value = true;
  isGeneratingReport.value = true;
  normsReportText.value = '';

  try {
    // –°–æ–±–∏—Ä–∞–µ–º payload –∏–∑ —Ñ–æ—Ä–º—ã
    handleGenerate();
    let payload = {};
    try {
      payload = JSON.parse(generatedJson.value || '{}');
    } catch {}

    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –æ—Ç—á—ë—Ç —Å —Å–µ—Ä–≤–µ—Ä–∞
    const response = await sendToApi(payload);
    const universal = buildLocalNormsReport(payload);
    if (response?.ok && response.data) {
      const serverBlock = typeof response.data === 'string'
        ? `–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–µ—Ä–≤–µ—Ä–∞:\n${String(response.data)}`
        : [
            '–°–µ—Ä–≤–µ—Ä: –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω',
            `ID: ${response.data.id}`,
            `–°—Ç–∞—Ç—É—Å: ${response.data.status}`,
            `–°–æ–∑–¥–∞–Ω: ${response.data.createdAt}`,
          ].join('\n');
      normsReportText.value = `${universal}\n\n${serverBlock}`;
    } else {
      normsReportText.value = universal;
    }
  } catch (e) {
    normsReportText.value = buildLocalNormsReport();
  } finally {
    isGeneratingReport.value = false;
  }
};

// API –≤–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∑–∞–¥–∞–π—Ç–µ VITE_ENABLE_PROJECT_API=false —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å
const projectApiEnabled =
  (import.meta.env.VITE_ENABLE_PROJECT_API ?? 'true').toLowerCase() !== 'false';

const sanitizePayloadForPrompt = (payload) => {
  try {
    const clone = JSON.parse(JSON.stringify(payload));
    if (clone.plan?.file?.content) {
      const contentLength = clone.plan.file.content.length;
      clone.plan.file.content = `[base64 content omitted: ${contentLength} chars]`;
    }
    return clone;
  } catch {
    return payload;
  }
};

const buildBtiPrompt = (payload) => {
  const header = [
    '–ó–∞–¥–∞—á–∞: –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –∏–∑ HomePlanner3D.',
    '–î–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–æ—Ä–º. –ù–∏–∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ JSON.',
  ].join('\n');
  const sanitized = sanitizePayloadForPrompt(payload);
  let prompt = `${header}\n\`\`\`json\n${JSON.stringify(sanitized, null, 2)}\n\`\`\``;
  if (prompt.length > MAX_BTI_PROMPT_LENGTH) {
    prompt =
      `${prompt.slice(0, MAX_BTI_PROMPT_LENGTH - 60)}\n` +
      '[...payload truncated to satisfy BTI prompt limit...]';
  }
  return prompt;
};

// –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—è (—á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
let planRecognizer = null;
async function getPlanRecognizer() {
  if (!planRecognizer) {
    try {
      planRecognizer = await import('./utils/planRecognizer.js');
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:', error);
      throw error;
    }
  }
  return planRecognizer;
}

// –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ ML –º–æ–¥–µ–ª–µ–π –≤ —Ñ–æ–Ω–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI)
let mlModelsLoading = false;
async function preloadMLModels() {
  if (mlModelsLoading) return;
  mlModelsLoading = true;

  try {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º ML –º–æ–¥–µ–ª–∏ –≤ —Ñ–æ–Ω–µ
    const mlLoader = await import('./utils/mlModelLoader.js');
    await mlLoader.loadAllModels({
      // –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø—É—Ç–∏ –∫ –º–æ–¥–µ–ª—è–º, –µ—Å–ª–∏ –æ–Ω–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
      // wallModelPath: '/models/wall-detection/model.json',
      // roomModelPath: '/models/room-segmentation/model.json',
      // metadataModelPath: '/models/metadata-extraction/model.json'
    });
    console.log('ML –º–æ–¥–µ–ª–∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é');
  } catch (error) {
    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∏—Ç—å ML –º–æ–¥–µ–ª–∏, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–π fallback:', error);
  } finally {
    mlModelsLoading = false;
  }
}

// –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥–µ–ª–µ–π –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
onMounted(() => {
  // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º ML –º–æ–¥–µ–ª–∏ –≤ —Ñ–æ–Ω–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI)
  preloadMLModels();

  // –ü—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ç–æ–∫–µ–Ω—É
  fetchCurrentUser();
});

const planSources = [
  'PDF / —Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç',
  'DWG / DXF',
  '–§–æ—Ç–æ / —Å–∫–∞–Ω',
  'IFC / BIM',
];

const layoutTypes = [
  '–°—Ç—É–¥–∏—è',
  '1-–∫–æ–º–Ω–∞—Ç–Ω–∞—è',
  '2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è',
  '3+ –∫–æ–º–Ω–∞—Ç–Ω–∞—è',
  '–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã',
];

const familyProfiles = [
  '–ü–∞—Ä–∞',
  '–°–µ–º—å—è —Å —Ä–µ–±—ë–Ω–∫–æ–º',
  '–°–µ–º—å—è —Å –¥–≤—É–º—è –¥–µ—Ç—å–º–∏',
  '–§—Ä–∏–ª–∞–Ω—Å–µ—Ä/–æ—Ñ–∏—Å + –∂–∏–ª—å—ë',
  '–°–¥–∞—á–∞ –≤ –∞—Ä–µ–Ω–¥—É',
];

const formData = reactive({
  address: '',
  area: '',
  planType: planSources[0],
  layoutType: layoutTypes[1],
  familyProfile: familyProfiles[0],
  goal: '–ë–æ–ª—å—à–µ —Å–≤–µ—Ç–∞ –∏ —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ',
  prompt: '–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∫—É—Ö–Ω—é –∏ –≥–æ—Å—Ç–∏–Ω—É—é, –¥–æ–±–∞–≤–∏—Ç—å –≥–∞—Ä–¥–µ—Ä–æ–± —É –≤—Ö–æ–¥–∞',
  ceilingHeight: '2.7',
  floorDelta: '0',
  roomsText: '',
  wallsText: '',
  constraintsText: '–Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –∫—É—Ö–Ω—é –Ω–∞–¥ –∂–∏–ª–æ–π\n—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–µ–Ω—Ç—à–∞—Ö—Ç—É',
  regionRules: '–°–ù–∏–ü 31-02; –ñ–ö –†–§ —Å—Ç.25',
});

const generatedJson = ref('');
const isSubmitting = ref(false);
const submitStatus = ref('');
const uploadedFileMeta = ref(null);
const uploadedFileContent = ref('');
const fileError = ref('');
const recognitionStatus = ref('idle'); // 'idle' | 'processing' | 'success' | 'error'
const manualEditMode = ref(false);
const recognitionStats = ref(null); // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

// –°–æ—Å—Ç–æ—è–Ω–∏–µ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
const currentUser = ref(null);
const authMode = ref('login'); // 'login' | 'register'
const authLoading = ref(false);
const authError = ref('');
const isAuthModalOpen = ref(false);
const isAccountPage = ref(false);
const isChatPage = ref(false);
const isConstructorPage = ref(false);
const isContactsOpen = ref(false);
const isTelegramOpen = ref(false);
const isPolicyOpen = ref(false);

const authForm = reactive({
  login: '',
  password: '',
  username: '',
  email: '',
  birthday: '',
});

const handleAccountButtonClick = () => {
    isAccountPage.value = true;
  if (currentUser.value) {
    isAuthModalOpen.value = false;
  } else {
    isAuthModalOpen.value = false;
  }
};

const goToLanding = () => {
  isAccountPage.value = false;
  isChatPage.value = false;
  isConstructorPage.value = false;
};

const openAuthFromAccountPage = () => {
  isAuthModalOpen.value = true;
};

const handleLogout = () => {
  logout();
  isAccountPage.value = false;
  isAuthModalOpen.value = false;
};

const goToChat = () => {
  isChatPage.value = true;
};

const goToLandingFromChat = () => {
  isChatPage.value = false;
};

const goToConstructor = () => {
  isConstructorPage.value = true;
};

const goToLandingFromConstructor = () => {
  isConstructorPage.value = false;
};

const openContacts = () => { isContactsOpen.value = true; };
const closeContacts = () => { isContactsOpen.value = false; };
const openTelegram = () => { isTelegramOpen.value = true; };
const closeTelegram = () => { isTelegramOpen.value = false; };
const openPolicy = () => { isPolicyOpen.value = true; };
const closePolicy = () => { isPolicyOpen.value = false; };
const openTelegramExternal = () => {
  try { if (typeof window !== 'undefined') window.open('https://t.me/homeplanner3d', '_blank'); } catch {}
};

const parseRooms = () =>
  formData.roomsText
    .split('\n')
    .map((line, index) => line.trim())
    .filter(Boolean)
    .map((line, index) => {
      const [name, coords] = line.split(':');
      const vertices =
        coords
          ?.split(';')
          .map((pair) => pair.trim().split(',').map((value) => Number(value.trim())))
          .filter(
            (point) => point.length === 2 && !point.some((value) => Number.isNaN(value))
          )
          .map(([x, y]) => ({ x, y })) ?? [];
      return {
        id: `R${index + 1}`,
        name: name?.trim() || `–ü–æ–º–µ—â–µ–Ω–∏–µ ${index + 1}`,
        height: Number(formData.ceilingHeight) || 2.7,
        vertices,
      };
    });

  const parseWalls = () =>
    formData.wallsText
      .split('\n')
      .map((line) => line.trim())
      .filter(Boolean)
      .map((line, index) => {
        const [segment, type = '–Ω–µ–Ω–µ—Å—É—â–∞—è', thickness = '0.12'] = line.split(';');
        const [startStr, endStr] = segment.split('->');
        const [sx, sy] = startStr
          .split(',')
          .map((value) => Number(value.trim()))
          .slice(0, 2);
        const [ex, ey] = endStr
          .split(',')
          .map((value) => Number(value.trim()))
          .slice(0, 2);
        return {
          id: `W${index + 1}`,
          start: { x: sx, y: sy },
          end: { x: ex, y: ey },
          loadBearing: type.toLowerCase().includes('–Ω–µ—Å—É—â'),
          thickness: Number(thickness.trim()),
          wallType: String(type).trim(),
        };
      });

const parseConstraints = () =>
  formData.constraintsText
    .split('\n')
    .map((line) => line.trim())
    .filter(Boolean);

const handleGenerate = () => {
  const payload = {
    plan: {
      address: formData.address,
      area: Number(formData.area) || null,
      source: formData.planType,
      layoutType: formData.layoutType,
      familyProfile: formData.familyProfile,
      goal: formData.goal,
      prompt: formData.prompt,
      ceilingHeight: Number(formData.ceilingHeight) || null,
      floorDelta: Number(formData.floorDelta) || 0,
      recognitionStatus: recognitionStatus.value,
      file: uploadedFileMeta.value
        ? {
            name: uploadedFileMeta.value.name,
            size: uploadedFileMeta.value.sizeBytes || uploadedFileMeta.value.size,
            type: uploadedFileMeta.value.type,
            content: uploadedFileContent.value,
          }
        : null,
    },
    geometry: {
      rooms: formData.roomsText ? parseRooms() : [],
    },
    walls: formData.wallsText ? parseWalls() : [],
    constraints: {
      forbiddenMoves: parseConstraints(),
      regionRules: formData.regionRules,
    },
    timestamp: new Date().toISOString(),
  };

  generatedJson.value = JSON.stringify(payload, null, 2);
};

// GraphQL-–æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è Users (–ª–æ–∫–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –Ω–µ —Ç–∞—â–∏—Ç—å –∏—Ö –≤ –æ–±—â–∏–π –∫–ª–∏–µ–Ω—Ç)
const REGISTER_MUTATION = `
  mutation Register($input: RegisterInput!) {
    register(input: $input) {
        id
      email
        login
        username
        birthday
      }
  }
`;

const GET_USER_QUERY = `
  query GetUser($id: ID!) {
    getUser(id: $id) {
      id
      email
      login
      username
      birthday
    }
  }
`;

const USER_ID_STORAGE_KEY = 'homeplanner3d:userId';
const MAX_BTI_PROMPT_LENGTH = Number(import.meta.env.VITE_BTI_PROMPT_LIMIT || 500000);

const saveUserId = (id) => {
  try {
    if (typeof window !== 'undefined' && window.localStorage && id) {
      window.localStorage.setItem(USER_ID_STORAGE_KEY, String(id));
    }
  } catch {
    // ignore storage errors
  }
};

const getStoredUserId = () => {
  try {
    if (typeof window !== 'undefined' && window.localStorage) {
      return window.localStorage.getItem(USER_ID_STORAGE_KEY);
    }
  } catch {
    // ignore
  }
  return null;
};

const clearStoredUserId = () => {
  try {
    if (typeof window !== 'undefined' && window.localStorage) {
      window.localStorage.removeItem(USER_ID_STORAGE_KEY);
    }
  } catch {
    // ignore
  }
};

const getActiveUserId = () => {
  return currentUser.value?.id || getStoredUserId();
};

const normalizeUser = (user, fallbackId) => {
  if (!user) return null;
  return {
    ...user,
    id: user.id || (fallbackId ? String(fallbackId) : undefined),
  };
};

const fetchCurrentUser = async () => {
  const storedId = getStoredUserId();
  if (!storedId) {
    currentUser.value = null;
    return;
  }

  try {
    const data = await graphqlRequest(GET_USER_QUERY, { id: storedId });
    if (data && data.getUser) {
      const normalized = normalizeUser(data.getUser, storedId);
      currentUser.value = normalized;
      if (normalized?.id) saveUserId(normalized.id);
    } else {
      currentUser.value = null;
    }
  } catch (error) {
    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    currentUser.value = null;
  }
};

const handleAuthSubmit = async () => {
  authError.value = '';
  authLoading.value = true;

  try {
    if (authMode.value === 'register') {
  const input = {
        email: authForm.email,
    login: authForm.login,
        username: authForm.username || null,
    password: authForm.password,
        birthday: authForm.birthday || null,
      };

      const result = await graphqlRequest(REGISTER_MUTATION, { input });
      const userData = result?.register;

      if (!userData) {
        authError.value = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.';
        return;
      }

      const normalized = normalizeUser(userData, authForm.login);
      currentUser.value = normalized;
      if (normalized?.id) saveUserId(normalized.id);
    } else {
      if (!authForm.login) {
        authError.value = '–£–∫–∞–∂–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤—Ö–æ–¥–∞.';
        return;
      }

      const result = await graphqlRequest(GET_USER_QUERY, { id: authForm.login });
      const userData = result?.getUser;

      if (!userData) {
        authError.value = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.';
      return;
    }

      const normalized = normalizeUser(userData, authForm.login);
      currentUser.value = normalized;
      if (normalized?.id) saveUserId(normalized.id);
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:', error);
    authError.value = error.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
  } finally {
    authLoading.value = false;
  }
};

const logout = () => {
  clearStoredUserId();
  currentUser.value = null;
};

const formatBirthday = (value) => {
  if (!value) return '';
  try {
    const date = new Date(value);
    if (Number.isNaN(date.getTime())) return value;
    return date.toLocaleDateString('ru-RU');
  } catch {
    return value;
  }
};

/**
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥ —á–µ—Ä–µ–∑ GraphQL (createPlanningProject)
 */
  const sendToApi = async (payload) => {
  if (!projectApiEnabled) {
    console.info('BTI-agent API –æ—Ç–∫–ª—é—á—ë–Ω (VITE_ENABLE_PROJECT_API=false).');
    return { ok: false, unavailable: true };
  }

  try {
    const plan = payload?.plan || {};
    const geometry = payload?.geometry || {};
    const walls = payload?.walls || [];
    const constraints = payload?.constraints || {};

    const regionRulesArr = Array.isArray(constraints.regionRules)
      ? constraints.regionRules
      : String(constraints.regionRules || '')
          .split(';')
          .map((s) => s.trim())
          .filter(Boolean);

    const input = {
      plan: {
        address: String(plan.address || ''),
        area: Number(plan.area || 0),
        source: String(plan.source || ''),
        layoutType: String(plan.layoutType || ''),
        familyProfile: String(plan.familyProfile || ''),
        goal: String(plan.goal || ''),
        prompt: String(plan.prompt || ''),
        ceilingHeight: Number(plan.ceilingHeight || 2.7),
        floorDelta: Number(plan.floorDelta || 0),
        recognitionStatus: String(plan.recognitionStatus || 'idle'),
        file: plan.file
          ? {
              name: String(plan.file.name || ''),
              size: Number(plan.file.size || 0),
              type: String(plan.file.type || ''),
              content: String(plan.file.content || ''),
            }
          : undefined,
      },
      geometry: {
        rooms: Array.isArray(geometry.rooms)
          ? geometry.rooms.map((room, idx) => ({
              id: room.id || `R${idx + 1}`,
              name: String(room.name || `–ü–æ–º–µ—â–µ–Ω–∏–µ ${idx + 1}`),
              height: Number(room.height || 2.7),
              vertices: Array.isArray(room.vertices)
                ? room.vertices.map((v) => ({ x: Number(v.x || 0), y: Number(v.y || 0) }))
                : [],
            }))
          : [],
      },
      walls: Array.isArray(walls)
        ? walls.map((w, idx) => ({
            id: w.id || `W${idx + 1}`,
            start: { x: Number(w.start?.x || 0), y: Number(w.start?.y || 0) },
            end: { x: Number(w.end?.x || 0), y: Number(w.end?.y || 0) },
            loadBearing: !!w.loadBearing,
            thickness: Number(w.thickness || 0.12),
            wallType: w.wallType ? String(w.wallType) : undefined,
          }))
        : [],
      constraints: {
        forbiddenMoves: Array.isArray(constraints.forbiddenMoves) ? constraints.forbiddenMoves : [],
        regionRules: regionRulesArr,
      },
      clientTimestamp: typeof payload.timestamp === 'string' ? payload.timestamp : new Date().toISOString(),
    };

    const result = await graphqlRequest(CREATE_PLANNING_PROJECT_MUTATION, { input });
    return {
      ok: true,
      data: result.createPlanningProject,
    };
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä:', error);
    throw error;
  }
};

const fileToBase64 = (file) =>
  new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = () => reject(reader.error);
    reader.readAsDataURL(file);
  });

const recognizePlan = async (file) => {
  try {
    // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    const recognizerModule = await getPlanRecognizer();
    const recognizePlanImage = recognizerModule.recognizePlan;

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
    const result = await recognizePlanImage(file);

    // –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ, –∑–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–∫–∂–µ –∞–¥—Ä–µ—Å, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –∏–∑–≤–ª–µ—á—ë–Ω
    if (result.success && result.address) {
      formData.address = result.address;
    }

    return result;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:', error);
    return {
      success: false,
      error: error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏ –ø–ª–∞–Ω–∞'
    };
  }
};

const enableManualEdit = () => {
  manualEditMode.value = true;
};

const handleFileChange = async (event) => {
  fileError.value = '';
  const file = event.target.files?.[0];
  if (!file) {
    uploadedFileMeta.value = null;
    uploadedFileContent.value = '';
    recognitionStatus.value = 'idle';
    manualEditMode.value = false;
    recognitionStats.value = null;
    return;
  }
  const allowedTypes = [
    'application/pdf',
    'image/jpeg',
    'image/png',
    'image/jpg',
    'application/acad',
    'application/dwg',
    'application/dxf',
    'model/vnd.ifc',
  ];
  if (!allowedTypes.some((type) => file.type === type) && !file.name.match(/\.(dwg|dxf|ifc)$/i)) {
    fileError.value = '–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ñ–æ—Ä–º–∞—Ç. –ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF, DWG, DXF, IFC, JPG –∏–ª–∏ PNG.';
    uploadedFileMeta.value = null;
    uploadedFileContent.value = '';
    recognitionStatus.value = 'idle';
    return;
  }

  uploadedFileMeta.value = {
    name: file.name,
    size: `${(file.size / 1024).toFixed(1)} –ö–ë`, // –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    sizeBytes: file.size, // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    type: file.type || file.name.split('.').pop(),
  };
  uploadedFileContent.value = await fileToBase64(file);

  // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
  recognitionStatus.value = 'processing';
  manualEditMode.value = false;

  try {
    const recognitionResult = await recognizePlan(file);

    if (recognitionResult.success) {
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
      formData.roomsText = recognitionResult.rooms || '';
      formData.wallsText = recognitionResult.walls || '';
      if (recognitionResult.area) formData.area = recognitionResult.area;
      if (recognitionResult.ceilingHeight) formData.ceilingHeight = recognitionResult.ceilingHeight;
      if (recognitionResult.address) formData.address = recognitionResult.address;

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–≤–∞—Ä—Ç–∏—Ä—ã
      if (recognitionResult.apartmentType) {
        const typeIndex = layoutTypes.findIndex(t => t === recognitionResult.apartmentType);
        if (typeIndex >= 0) {
          formData.layoutType = layoutTypes[typeIndex];
        }
      }

      recognitionStatus.value = 'success';
      recognitionStats.value = recognitionResult.stats || null;

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏
      if (recognitionResult.stats) {
        console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:', recognitionResult.stats);
      }
    } else {
      // –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
      recognitionStatus.value = 'error';
      manualEditMode.value = true;
      fileError.value = recognitionResult.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ø–ª–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é.';
    }
  } catch (error) {
    recognitionStatus.value = 'error';
    manualEditMode.value = true;
    fileError.value = error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é.';
    console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:', error);
  }
};

const downloadJson = () => {
  if (!generatedJson.value) return;
  const blob = new Blob([generatedJson.value], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `homeplanner3d-payload-${Date.now()}.json`;
  link.click();
  URL.revokeObjectURL(url);
};

const handleSubmit = async () => {
  submitStatus.value = '';

  const activeUserId = getActiveUserId();
  if (!activeUserId) {
    submitStatus.value = '–ß—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.';
    isAuthModalOpen.value = true;
    setTimeout(() => {
      submitStatus.value = '';
    }, 4000);
    return;
  }
  handleGenerate();
  if (!generatedJson.value) {
    submitStatus.value = '–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏.';
    return;
  }

  // –ü–∞—Ä—Å–∏–º payload –∏–∑ JSON
  let payload;
  try {
    payload = JSON.parse(generatedJson.value);
  } catch (error) {
    submitStatus.value = '–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö.';
    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ payload:', error);
    return;
  }

  isSubmitting.value = true;
  submitStatus.value = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...';

  try {
    const response = await sendToApi(payload);

    if (response.unavailable) {
      submitStatus.value = 'API –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.';
      return;
    }

    if (response.ok && response.data) {
      const created = response.data;
      submitStatus.value = created?.id
        ? `–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω (ID: ${created.id}).`
        : '–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω.';
    } else {
      submitStatus.value = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É.';
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
    submitStatus.value = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–≤—è–∑–∏ —Å API.';
  } finally {
    isSubmitting.value = false;
  }
};

const steps = [
  {
    title: '–†–∞—Å–ø–æ–∑–Ω–∞—ë–º –ø–ª–∞–Ω',
    description:
      '–ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF, DWG –∏–ª–∏ —Ñ–æ—Ç–æ ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º —Å—Ç—Ä–æ–∏—Ç —Ç–æ—á–Ω—É—é –≥–µ–æ–º–µ—Ç—Ä–∏—é –∏ —Å–µ—Ç–∫—É –ø–æ–º–µ—â–µ–Ω–∏–π.',
    details: [
      '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ PDF/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, OCR –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö',
      '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–µ–Ω, –∫–æ–º–Ω–∞—Ç –∏ –º–∞—Å—à—Ç–∞–±–∞ —Å ML/–∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏',
      '–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –∏ –ø–æ–∫–∞–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è'
    ],
  },
  {
    title: '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä 2.5D/FPV',
    description:
      '–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä: —Å–Ω–æ—Å–∏—Ç–µ —Å—Ç–µ–Ω—ã, —Å—Ç–∞–≤—å—Ç–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏, —Ä–∞—Å—Å—Ç–∞–≤–ª—è–π—Ç–µ –º–µ–±–µ–ª—å.',
    details: [
      '–†–µ–∂–∏–º –ø–ª–∞–Ω–∞ —Å–≤–µ—Ä—Ö—É –∏ –≤–∏–¥ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞',
      '–°–Ω–æ—Å/–ø–µ—Ä–µ–Ω–æ—Å —Å—Ç–µ–Ω, –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏, –±–∞–∑–æ–≤–∞—è –º–µ–±–µ–ª—å',
      '–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤'
    ],
  },
  {
    title: '–ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ—Ä–º',
    description:
      '–ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å–≤–µ—Ä—è–µ—Ç—Å—è —Å –°–ù–∏–ü, –ñ–∏–ª–∏—â–Ω—ã–º –∫–æ–¥–µ–∫—Å–æ–º –∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –ñ–ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.',
    details: [
      '–ù–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã –∏ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø—Ä–æ—ë–º—ã',
      '–ú–æ–∫—Ä—ã–µ –∑–æ–Ω—ã –∏ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è',
      '–ü–æ–∂–∞—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ —ç–≤–∞–∫—É–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—É—Ç–∏'
    ],
  },
  {
    title: '–ü–µ—Ä–µ–¥–∞—ë–º –≤ –ë–¢–ò',
    description:
      '–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É, –∏ —ç–∫—Å–ø–µ—Ä—Ç—ã –ë–¢–ò –æ—Ñ–æ—Ä–º—è—Ç –ø—Ä–æ–µ–∫—Ç –∏ —Å–æ–≥–ª–∞—Å—É—é—Ç –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É.',
    details: [
      '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —á–µ—Ä—Ç–µ–∂–µ–π',
      '–ü–µ—Ä–µ–¥–∞—á–∞ –≤ –ë–¢–ò –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞',
      '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –∏ —Å—Ç–∞—Ç—É—Å–æ–≤'
    ],
  },
];

const builderTools = [
  {
    title: '–°–Ω–æ—Å/–ø–µ—Ä–µ–Ω–æ—Å —Å—Ç–µ–Ω',
    description:
      '–í—ã–¥–µ–ª—è–π—Ç–µ –Ω–µ—Å—É—â–∏–µ –∏ –Ω–µ–Ω–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã, –ø—Ä–æ–±—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–æ—ë–º—ã –∏ —É—Å–∏–ª–µ–Ω–∏—è.',
  },
  {
    title: '–ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –∏ –∑–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ',
    description: '–î–æ–±–∞–≤–ª—è–π—Ç–µ –ª—ë–≥–∫–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏, –æ–±—ä–µ–¥–∏–Ω—è–π—Ç–µ –∏ –¥–µ–ª–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—ã.',
  },
  {
    title: '–ë–∞–∑–æ–≤–∞—è –º–µ–±–µ–ª—å',
    description:
      '–†–∞—Å—Å—Ç–∞–≤–ª—è–π—Ç–µ –∫–æ—Ä–æ–±–æ—á–Ω—ã–µ –±–ª–æ–∫–∏ –∫—É—Ö–Ω–∏, –¥–∏–≤–∞–Ω–æ–≤, –∫—Ä–æ–≤–∞—Ç–µ–π, —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏—Ç—å —ç—Ä–≥–æ–Ω–æ–º–∏–∫—É.',
  },
  {
    title: '–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π',
    description:
      '–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤–µ—Ä—Å–∏–∏, —Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π —Å —Å–µ–º—å—ë–π –∏ –¥–∏–∑–∞–π–Ω–µ—Ä–æ–º.',
  },
];

const builderModes = [
  {
    title: '2.5D –ø–ª–∞–Ω —Å–≤–µ—Ä—Ö—É',
    description:
      '–¢–æ—á–Ω—ã–π –º–∞—Å—à—Ç–∞–±, —Å–µ—Ç–∫–∞ –∏ –ø—Ä–∏–≤—è–∑–∫–∏ ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.',
  },
  {
    title: '–†–µ–∂–∏–º –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞',
    description:
      '–ü–æ–≥—É–ª—è–π—Ç–µ –ø–æ –±—É–¥—É—â–µ–π –∫–≤–∞—Ä—Ç–∏—Ä–µ; —Å—Ü–µ–Ω—É —Ä–µ–Ω–¥–µ—Ä–∏—Ç Unity-—Å–∫—Ä–∏–ø—Ç –∫–æ–ª–ª–µ–≥–∏.',
  },
];

const checks = [
  {
    title: '–ù–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã',
    description: '–§–∏–∫—Å–∏—Ä—É–µ–º –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø—Ä–æ—ë–º—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—Å–∏–ª–µ–Ω–∏–µ.',
    status: 'ok',
    statusLabel: 'OK',
  },
  {
    title: '–ú–æ–∫—Ä—ã–µ –∑–æ–Ω—ã',
    description:
      '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å –∫—É—Ö–æ–Ω—å –∏ —Å–∞–Ω—É–∑–ª–æ–≤ –Ω–∞–¥ –∂–∏–ª—ã–º–∏ –∫–æ–º–Ω–∞—Ç–∞–º–∏.',
    status: 'warning',
    statusLabel: 'Warning',
  },
  {
    title: '–í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –∏ –¥—ã–º–æ—É–¥–∞–ª–µ–Ω–∏–µ',
    description: '–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ —à–∞—Ö—Ç –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –°–ù–∏–ü–æ–≤.',
    status: 'ok',
    statusLabel: 'OK',
  },
  {
    title: '–ü–æ–∂–∞—Ä–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å',
    description:
      '–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º —ç–≤–∞–∫—É–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—É—Ç–∏ –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ö–æ–¥–æ–≤.',
    status: 'info',
    statusLabel: 'Info',
  },
];

const testimonials = [
  {
    author: '–ï–ª–µ–Ω–∞, –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä',
    type: '–∞—Ä—Ö–±—é—Ä–æ ¬´–§–æ—Ä–º–∞¬ª',
    quote: '–ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ—Ä–º —ç–∫–æ–Ω–æ–º—è—Ç –Ω–∞–º —á–∞—Å—ã –Ω–∞ –∫–∞–∂–¥–æ–º –ø—Ä–æ–µ–∫—Ç–µ.',
  },
  {
    author: '–ò–≥–æ—Ä—å, –≤–ª–∞–¥–µ–ª–µ—Ü –¥–≤—É—à–∫–∏',
    type: '–ú–æ—Å–∫–≤–∞',
    quote: '–£–≤–∏–¥–µ–ª —Ç—Ä–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è –∑–∞ –≤–µ—á–µ—Ä –∏ —Å—Ä–∞–∑—É –≤—ã–±—Ä–∞–ª –ª—É—á—à–∏–π.',
  },
  {
    author: 'Zebra Development',
    type: '–¥–µ–≤–µ–ª–æ–ø–µ—Ä',
    quote: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–≥ –±—ã—Å—Ç—Ä–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –≤ —à–æ—É-—Ä—É–º–µ.',
  },
];

const expertChannels = [
  '–í—ã–µ–∑–¥ –∏–Ω–∂–µ–Ω–µ—Ä–∞ –ë–¢–ò –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –¥–Ω–µ–π',
  '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–º–µ—Ç',
  '–ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞–∫–µ—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –ú–§–¶',
];

const faq = [
  {
    question: '–°–∫–æ–ª—å–∫–æ –∑–∞–Ω–∏–º–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ?',
    answer: '–û–±—ã—á–Ω–æ 2‚Äì3 –º–∏–Ω—É—Ç—ã –¥–ª—è –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥–æ 120 –º¬≤, –±–µ–∑ —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã.',
  },
  {
    question: '–ò–º–µ–µ—Ç –ª–∏ –æ—Ç—á—ë—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é —Å–∏–ª—É?',
    answer:
      '–î–∞, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ–æ—Ä–º–∞—Ç—ã –¥–ª—è –ø–æ–¥–∞—á–∏ –≤ –ú–§–¶ –∏–ª–∏ –≤–µ–¥–æ–º—Å—Ç–≤–∞, –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫–∞.',
  },
  {
    question: '–ö–∞–∫ –∑–∞—â–∏—â–µ–Ω—ã –º–æ–∏ –¥–∞–Ω–Ω—ã–µ?',
    answer:
      '–í—Å–µ –ø–ª–∞–Ω—ã —à–∏—Ñ—Ä—É—é—Ç—Å—è, —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç—É—Ä–µ –∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ –∑–∞–ø—Ä–æ—Å—É.',
  },
];

const expertSubmitStatus = ref('');
const expertsForm = reactive({ nameCity: '', contact: '', comment: '' });
const canSubmitExpert = computed(() => {
  const nameCity = expertsForm.nameCity.trim();
  const contact = expertsForm.contact.trim();
  const comment = expertsForm.comment.trim();
  const placeholderName = '–ú–∞—Ä–∏—è, –ú–æ—Å–∫–≤–∞';
  const placeholderContact = '@telegram –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω';
  const placeholderComment = '–ö–≤–∞—Ä—Ç–∏—Ä–∞ 62 –º¬≤, –Ω—É–∂–µ–Ω –ø—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏';
  if (!nameCity || nameCity === placeholderName) return false;
  if (!/^[A-Za-z–ê-–Ø–∞-—è—ë–Å][A-Za-z–ê-–Ø–∞-—è—ë–Å\-\s]*\s*,\s*[A-Za-z–ê-–Ø–∞-—è—ë–Å\-\s]+$/.test(nameCity)) return false;
  if (!contact || contact === placeholderContact) return false;
  const phoneOk = /^\+?[0-9\-\s()]{10,20}$/.test(contact);
  const tgOk = /^@[A-Za-z0-9_]{5,32}$/.test(contact);
  if (!(phoneOk || tgOk)) return false;
  if (!comment || comment === placeholderComment) return false;
  if (comment.length < 8) return false;
  return true;
});
const submitExpertRequest = () => {
  if (!canSubmitExpert.value) {
    expertSubmitStatus.value = '';
    return;
  }
  expertSubmitStatus.value = '–ó–∞—è–≤–∫–∞ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞';
};
const expertErrors = computed(() => {
  const errors = { nameCity: '', contact: '', comment: '' };
  const nameCity = expertsForm.nameCity.trim();
  const contact = expertsForm.contact.trim();
  const comment = expertsForm.comment.trim();
  const placeholderName = '–ú–∞—Ä–∏—è, –ú–æ—Å–∫–≤–∞';
  const placeholderContact = '@telegram –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω';
  const placeholderComment = '–ö–≤–∞—Ä—Ç–∏—Ä–∞ 62 –º¬≤, –Ω—É–∂–µ–Ω –ø—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏';

  if (!nameCity || nameCity === placeholderName) {
    errors.nameCity = '–í–≤–µ–¥–∏—Ç–µ ¬´–ò–º—è, –ì–æ—Ä–æ–¥¬ª';
  } else if (!/^[A-Za-z–ê-–Ø–∞-—è—ë–Å][A-Za-z–ê-–Ø–∞-—è—ë–Å\-\s]*\s*,\s*[A-Za-z–ê-–Ø–∞-—è—ë–Å\-\s]+$/.test(nameCity)) {
    errors.nameCity = '–§–æ—Ä–º–∞—Ç: –ò–º—è, –ì–æ—Ä–æ–¥ (–±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã, –¥–µ—Ñ–∏—Å)';
  }

  if (!contact || contact === placeholderContact) {
    errors.contact = '–£–∫–∞–∂–∏—Ç–µ @telegram –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω';
  } else {
    const phoneOk = /^\+?[0-9\-\s()]{10,20}$/.test(contact);
    const tgOk = /^@[A-Za-z0-9_]{5,32}$/.test(contact);
    if (!(phoneOk || tgOk)) {
      errors.contact = '–ü—Ä–∏–º–µ—Ä: @username –∏–ª–∏ +7 916 123-45-67';
    }
  }

  if (!comment || comment === placeholderComment) {
    errors.comment = '–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–ª–æ–≤–∞—Ö';
  } else if (comment.length < 8) {
    errors.comment = '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π';
  }

  return errors;
});

const downloadGuide = () => {
  const lines = [
    '–ì–∏–¥ –ø–æ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã',
    '',
    '1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞',
    '‚Ä¢ –°–æ–±–µ—Ä–∏—Ç–µ —Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –∏ –ø–æ—ç—Ç–∞–∂–Ω—ã–π –ø–ª–∞–Ω –¥–æ–º–∞.',
    '‚Ä¢ –£—Ç–æ—á–Ω–∏—Ç–µ —Å–µ—Ä–∏—é –¥–æ–º–∞, –Ω–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã –∏ –º–æ–∫—Ä—ã–µ –∑–æ–Ω—ã.',
    '‚Ä¢ –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ —Ü–µ–ª–∏: –±–æ–ª—å—à–µ —Å–≤–µ—Ç–∞, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞, –∫–∞–±–∏–Ω–µ—Ç –∏ —Ç.–¥.',
    '',
    '2. –ê–Ω–∞–ª–∏–∑ –ø–ª–∞–Ω–∞',
    '‚Ä¢ –ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF/—Ñ–æ—Ç–æ –ø–ª–∞–Ω–∞ –≤ HomePlanner3D.',
    '‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ —Å—Ç–µ–Ω—ã, –∫–æ–º–Ω–∞—Ç—ã –∏ –º–∞—Å—à—Ç–∞–±—ã.',
    '‚Ä¢ –£—Ç–æ—á–Ω–∏—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –ø–µ—Ä–µ–Ω–æ—Å –∫—É—Ö–æ–Ω—å/—Å–∞–Ω—É–∑–ª–æ–≤, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è, –ø–æ–∂–∞—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.',
    '',
    '3. –†–µ–¥–∞–∫—Ç—É—Ä–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è',
    '‚Ä¢ –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–æ—ë–º—ã, –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –∏ –º–µ–±–µ–ª—å.',
    '‚Ä¢ –û—Ü–µ–Ω–∏—Ç–µ –ø–ª–∞–Ω —Å–≤–µ—Ä—Ö—É –∏ –ø—Ä–æ–≥—É–ª–∫—É –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞.',
    '',
    '4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º',
    '‚Ä¢ –ù–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã: –ø—Ä–æ—ë–º—ã —Ç–æ–ª—å–∫–æ —Å –ø—Ä–æ–µ–∫—Ç–Ω—ã–º —É—Å–∏–ª–µ–Ω–∏–µ–º.',
    '‚Ä¢ –ú–æ–∫—Ä—ã–µ –∑–æ–Ω—ã: –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞–¥ –∂–∏–ª—ã–º–∏ –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.',
    '‚Ä¢ –í–µ–Ω—Ç–∏–ª—è—Ü–∏—è: —à–∞—Ö—Ç—ã –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å.',
    '‚Ä¢ –ü–æ–∂–∞—Ä–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ø—Ä–æ—Ö–æ–¥—ã ‚â• 0.9 –º, –¥–≤–µ—Ä–∏ –º–æ–∫—Ä—ã—Ö –∑–æ–Ω ‚â• 0.7 –º.',
    '',
    '5. –î–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è',
    '‚Ä¢ –ü–ª–∞–Ω –¥–æ/–ø–æ—Å–ª–µ —Å —ç–∫—Å–ø–ª–∏–∫–∞—Ü–∏–µ–π.',
    '‚Ä¢ –ü–æ—ç—Ç–∞–∂–Ω—ã–π –ø–ª–∞–Ω –∏ —Å–µ—Ä–∏—è –¥–æ–º–∞.',
    '‚Ä¢ –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (–ø—Ä–∏ –Ω–µ—Å—É—â–∏—Ö/–∏–Ω–∂–µ–Ω–µ—Ä–∏–∏).',
    '',
    '6. –°–æ–≤–µ—Ç—ã',
    '‚Ä¢ –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –º–∏–Ω–∏‚Äë–≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤, –∑–∞—Ç–µ–º —É—Å–ª–æ–∂–Ω—è–π—Ç–µ.',
    '‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤–µ—Ä—Å–∏–∏ –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.',
    '‚Ä¢ –ü—Ä–∏ —Å–æ–º–Ω–µ–Ω–∏—è—Ö ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å —ç–∫—Å–ø–µ—Ä—Ç–æ–º –ë–¢–ò.',
    '',
    '‚Äî HomePlanner3D'
  ];

  const pageW = 595;
  const pageH = 842;
  const scale = Math.min(2, window.devicePixelRatio || 1);
  const canvas = document.createElement('canvas');
  canvas.width = Math.floor(pageW * scale);
  canvas.height = Math.floor(pageH * scale);
  const ctx = canvas.getContext('2d');
  ctx.scale(scale, scale);
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(0, 0, pageW, pageH);
  ctx.fillStyle = '#333333';
  ctx.font = '8px Arial, sans-serif';
  const x = 40;
  const maxWidth = pageW - 80;
  let y = 60;

  const drawWrapped = (text) => {
    if (!text) { y += 4; return; }
    const words = text.split(' ');
    let line = '';
    for (let i = 0; i < words.length; i++) {
      const test = line ? line + ' ' + words[i] : words[i];
      if (ctx.measureText(test).width > maxWidth) {
        ctx.fillText(line, x, y);
        y += 12;
        line = words[i];
      } else {
        line = test;
      }
    }
    if (line) {
      ctx.fillText(line, x, y);
      y += 12;
    }
  };

  ctx.font = '600 10px Arial, sans-serif';
  drawWrapped(lines[0]);
  ctx.font = '8px Arial, sans-serif';
  lines.slice(1).forEach(drawWrapped);

  const dataUrl = canvas.toDataURL('image/jpeg', 0.92);
  const base64 = dataUrl.split(',')[1];
  const binary = atob(base64);
  const imgBytes = new Uint8Array(binary.length);
  for (let i = 0; i < binary.length; i++) imgBytes[i] = binary.charCodeAt(i);

  const enc = new TextEncoder();
  const parts = [];
  const offsets = [];
  let pos = 0;
  const pushStr = (s) => { const b = enc.encode(s); parts.push(b); offsets.push(pos); pos += b.length; };
  const pushPre = (s) => { const b = enc.encode(s); parts.push(b); offsets.push(pos); pos += b.length; };
  const pushBin = (b) => { parts.push(b); pos += b.length; };
  const pushPost = (s) => { const b = enc.encode(s); parts.push(b); pos += b.length; };

  pushStr('%PDF-1.4\n');
  pushStr('1 0 obj\n<< /Type /Catalog /Pages 2 0 R >>\nendobj\n');
  pushStr('2 0 obj\n<< /Type /Pages /Kids [3 0 R] /Count 1 >>\nendobj\n');
  pushStr('3 0 obj\n<< /Type /Page /Parent 2 0 R /MediaBox [0 0 595 842] /Resources << /XObject << /Im0 4 0 R >> >> /Contents 5 0 R >>\nendobj\n');

  const imgObjHeader = `4 0 obj\n<< /Type /XObject /Subtype /Image /Width ${pageW} /Height ${pageH} /ColorSpace /DeviceRGB /BitsPerComponent 8 /Filter /DCTDecode /Length ${imgBytes.length} >>\nstream\n`;
  pushPre(imgObjHeader);
  pushBin(imgBytes);
  pushPost('\nendstream\nendobj\n');

  const contentStream = 'q\n595 0 0 842 0 0 cm\n/Im0 Do\nQ\n';
  pushStr(`5 0 obj\n<< /Length ${enc.encode(contentStream).length} >>\nstream\n${contentStream}endstream\nendobj\n`);

  const xrefPos = pos;
  let xref = 'xref\n0 6\n';
  xref += '0000000000 65535 f \n';
  for (let i = 0; i < offsets.length; i++) {
    const off = String(offsets[i]).padStart(10, '0');
    xref += `${off} 00000 n \n`;
  }
  const trailer = `trailer\n<< /Size 6 /Root 1 0 R >>\nstartxref\n${xrefPos}\n%%EOF`;

  const pdfBytes = new Blob([...parts, enc.encode(xref), enc.encode(trailer)], { type: 'application/pdf' });
  const url = URL.createObjectURL(pdfBytes);
  const link = document.createElement('a');
  link.href = url;
  link.download = `homeplanner3d-guide-${Date.now()}.pdf`;
  link.click();
  URL.revokeObjectURL(url);
};
</script>

<style scoped>
:global(body) {
  margin: 0;
  font-family: 'Inter', 'Segoe UI', sans-serif;
  background: #0b0d12;
  color: #f5f6f8;
  line-height: 1.5;
}

.page {
  padding: 32px 64px 96px;
  max-width: 1200px;
  margin: 0 auto;
  overflow-x: hidden;
}

h1,
h2,
h3 {
  margin: 0 0 12px;
  line-height: 1.2;
}

p {
  margin: 0 0 16px;
  color: #c6cad4;
}

section {
  margin-top: 72px;
}

.hero {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 32px;
  padding: 56px;
  background: radial-gradient(circle at top left, #1f2639, #11131c);
  border-radius: 28px;
  position: relative;
  overflow: hidden;
}

.hero__topbar {
  position: absolute;
  top: 20px;
  left: 24px;
  right: 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 14px;
  color: #c6cad4;
  pointer-events: none;
}

.hero__logo {
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
}

.hero__top-actions {
  display: flex;
  align-items: center;
  gap: 12px;
  pointer-events: auto;
}

.hero__user {
  font-size: 13px;
  opacity: 0.9;
}

.hero__login-btn {
  padding-inline: 14px;
}

.hero__content {
  max-width: 520px;
}

.hero__badge {
  display: inline-flex;
  padding: 4px 12px;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.1);
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.hero__subtitle {
  font-size: 18px;
  color: #dfe2ea;
}

.hero__actions {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  margin-top: 24px;
}

.hero__visual {
  display: flex;
  align-items: center;
  justify-content: center;
}

.account__tabs {
  display: inline-flex;
  padding: 4px;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.04);
  margin-bottom: 16px;
}

.account__tab {
  border: none;
  background: transparent;
  color: #c6cad4;
  padding: 6px 16px;
  border-radius: 999px;
  cursor: pointer;
  font-size: 14px;
}

.account__tab--active {
  background: #2f5dff;
  color: #fff;
}

.account__form {
  display: grid;
  gap: 12px;
}

.account__form label {
  display: flex;
  flex-direction: column;
  gap: 6px;
  font-size: 14px;
  color: #dfe2ea;
}

.account__form input {
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  background: transparent;
  color: #fff;
  padding: 10px;
  font-family: inherit;
}

.account__actions {
  margin-top: 8px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  align-items: flex-start;
}

.account__error {
  color: #ff9b9b;
  font-size: 13px;
}

.account__profile {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.account__card {
  padding: 16px 18px;
  border-radius: 16px;
  background: #151826;
  border: 1px solid rgba(255, 255, 255, 0.06);
}

.account__card p {
  margin-bottom: 6px;
}

.account__hint {
  font-size: 13px;
  color: #9aa5c1;
}

.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 40;
}

.modal {
  width: 100%;
  max-width: 420px;
  background: #111423;
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: 0 24px 80px rgba(0, 0, 0, 0.6);
  padding: 20px 22px 22px;
}

.modal__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}

.modal__close {
  border: none;
  background: transparent;
  color: #9aa5c1;
  font-size: 22px;
  line-height: 1;
  cursor: pointer;
}

.modal__body {
  margin-top: 4px;
}

.intake {
  margin-top: 72px;
  padding: 32px;
  border-radius: 24px;
  background: #111423;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.intake__hints {
  color: #9aa5c1;
  padding-left: 18px;
}

.intake__hints li {
  margin-bottom: 4px;
}

.intake__form {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 18px;
  margin-top: 24px;
}

.intake__form label {
  display: flex;
  flex-direction: column;
  gap: 8px;
  font-size: 14px;
  color: #dfe2ea;
}

.intake__form small {
  color: #9aa5c1;
}

.intake__wide {
  grid-column: 1 / -1;
}

.intake__form input,
.intake__form select,
.intake__form textarea {
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  background: transparent;
  color: #fff;
  padding: 10px;
  font-family: inherit;
}

.intake__form input[type='file'] {
  padding: 6px;
  background: rgba(255, 255, 255, 0.05);
}

.intake__actions {
  display: flex;
  gap: 12px;
  align-items: center;
}

.intake__status {
  color: #9cb4ff;
  margin-top: 12px;
}

.intake__error {
  color: #ff9b9b;
}

.intake__success {
  color: #9cb4ff;
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.intake__recognition {
  color: #ffe5a3;
  display: flex;
  align-items: center;
  gap: 8px;
}

.intake__edit-btn {
  background: transparent;
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: #fff;
  padding: 4px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 12px;
  margin-left: 8px;
}

.intake__edit-btn:hover {
  background: rgba(255, 255, 255, 0.1);
}

.intake__geometry-section {
  grid-column: 1 / -1;
  margin-top: 24px;
  padding-top: 24px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.intake__section-title {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 16px;
  color: #dfe2ea;
}

.intake__stats {
  font-size: 12px;
  opacity: 0.8;
  margin-left: 8px;
}

.intake__result {
  margin-top: 24px;
  padding: 20px;
  border-radius: 16px;
  background: #0d101b;
  border: 1px solid rgba(255, 255, 255, 0.05);
  overflow: auto;
}

.intake__result pre {
  max-height: 320px;
  overflow: auto;
  font-size: 13px;
  background: rgba(0, 0, 0, 0.3);
  padding: 16px;
  border-radius: 12px;
}

.visual-card {
  width: 100%;
  padding: 24px;
  border-radius: 20px;
  background: rgba(11, 14, 26, 0.8);
  border: 1px solid rgba(255, 255, 255, 0.06);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.45);
}

.visual-card__plan {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-top: 20px;
  padding: 16px;
  border-radius: 16px;
  background: rgba(255, 255, 255, 0.04);
  text-transform: uppercase;
  font-size: 13px;
  text-align: center;
}

.visual-card__col {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.visual-card__img {
  width: 100%;
  height: auto;
  border-radius: 12px;
  background: #0b0d12;
}

.flow h2 {
  margin-bottom: 24px;
}

.flow__subtitle {
  margin-top: -8px;
  margin-bottom: 28px;
  color: #98a2c3;
}

.flow__steps {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
}

.step {
  padding: 24px;
  border-radius: 20px;
  background: #151826;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.step__number {
  width: 36px;
  height: 36px;
  border-radius: 12px;
  background: #2f5dff;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 12px;
  font-weight: 600;
}

.step__link {
  color: #7d8bff;
  text-decoration: none;
  font-weight: 600;
}

.flow-modal__lead {
  color: #c6cad4;
  margin-bottom: 12px;
}

.flow-modal__list {
  padding-left: 18px;
  color: #c6cad4;
}

.flow-modal__list li {
  margin-bottom: 6px;
}

.case-modal {
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-height: 60vh;
  overflow-y: auto;
}

.case-modal__section h4 {
  margin: 8px 0;
}

.case-modal__list {
  padding-left: 18px;
  color: #c6cad4;
}

.report-modal {
  max-height: 60vh;
  overflow-y: auto;
}

.report-modal__text {
  white-space: pre-wrap;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 14px;
  color: #c6cad4;
}

.recognition {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 32px;
  align-items: center;
}

.recognition__preview {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 18px;
}

.preview-card {
  padding: 16px;
  border-radius: 20px;
  background: #151826;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.preview-card__plan {
  height: 180px;
  border-radius: 14px;
  margin-top: 12px;
  background-image: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.08) 50%, rgba(255, 255, 255, 0.08) 75%, transparent 75%, transparent);
  background-size: 24px 24px;
}

.preview-card__plan--clean {
  background-image: linear-gradient(90deg, rgba(255, 255, 255, 0.08) 1px, transparent 1px),
    linear-gradient(0deg, rgba(255, 255, 255, 0.08) 1px, transparent 1px);
  background-size: 24px 24px;
}

.preview-card__img {
  width: 100%;
  height: auto;
  border-radius: 14px;
  margin-top: 12px;
  background: #0b0d12;
}

.demo__img {
  width: 100%;
  max-height: 420px;
  object-fit: cover;
  border-radius: 18px;
  background: #0b0d12;
}

@media (max-width: 1024px) {
  .page { padding: 24px 32px 72px; }
  .hero { padding: 40px; }
  .demo__img { max-height: 360px; }
}

@media (max-width: 768px) {
  .hero { grid-template-columns: 1fr; padding: 32px; }
  .hero__content { max-width: none; }
  .hero__actions { display: grid; grid-template-columns: 1fr; gap: 10px; }
  .hero__visual { margin-top: 12px; }

  .builder__grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
  .builder__modes { display: grid; grid-template-columns: 1fr; gap: 12px; }
  .checks__list { display: grid; grid-template-columns: 1fr; gap: 12px; }
  .testimonials__list { display: grid; grid-template-columns: 1fr; gap: 12px; }

  .demo { display: grid; grid-template-columns: 1fr; gap: 16px; }
  .demo__img { max-height: 300px; }

  .modal { width: 90vw; max-width: 680px; }
  .preview-card__img { max-height: 220px; object-fit: cover; }
}

@media (max-width: 480px) {
  .page { padding: 20px 20px 64px; }
  .hero { border-radius: 20px; padding: 24px; }
  .hero__actions .btn { width: 100%; }
  .demo__img { max-height: 240px; border-radius: 16px; }
  .modal { width: 92vw; }
}

.builder__grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 18px;
  margin-top: 28px;
}

.builder-card {
  padding: 20px;
  border-radius: 18px;
  background: #171b2b;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.builder__modes {
  margin-top: 28px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 18px;
}

.mode-card {
  padding: 20px;
  border-radius: 18px;
  background: rgba(47, 93, 255, 0.1);
  border: 1px solid rgba(47, 93, 255, 0.25);
}

.checks__list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin: 32px 0;
}

.check-card {
  padding: 20px;
  border-radius: 18px;
  background: #141821;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.status {
  display: inline-flex;
  padding: 4px 12px;
  border-radius: 999px;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.status--ok {
  background: rgba(76, 175, 80, 0.15);
  color: #a5ffb6;
}

.status--warning {
  background: rgba(255, 193, 7, 0.15);
  color: #ffe5a3;
}

.status--info {
  background: rgba(126, 180, 255, 0.15);
  color: #cfe0ff;
}

.testimonials__list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin-top: 24px;
}

.testimonial-card {
  padding: 20px;
  border-radius: 18px;
  background: #121421;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.testimonial-card__text {
  font-style: italic;
  color: #dfe2ea;
}

.testimonial-card__author {
  margin-top: 12px;
  color: #9aa5c1;
  font-size: 14px;
}

.experts {
  margin-top: 72px;
  padding: 40px;
  border-radius: 24px;
  background: #111423;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 32px;
}

.experts ul {
  padding-left: 18px;
  color: #c6cad4;
}

.experts__form {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.experts__form label {
  display: flex;
  flex-direction: column;
  gap: 6px;
  font-size: 14px;
  color: #dfe2ea;
}

.experts__form input,
.experts__form textarea {
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  background: transparent;
  color: #fff;
  padding: 10px;
  font-family: inherit;
}

.experts__form textarea {
  min-height: 96px;
  resize: none;
}

.experts__status {
  color: #a5ffb6;
  font-weight: 600;
}

.field-hint {
  color: #98a2c3;
  font-size: 12px;
}

.field-error {
  color: #ff9b9b;
  font-size: 12px;
}

.faq__list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin: 24px 0;
}

.faq-card {
  padding: 20px;
  border-radius: 18px;
  background: #151826;
  border: 1px solid rgba(255, 255, 255, 0.04);
}

.faq__actions {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
}

.footer {
  margin-top: 96px;
  padding-top: 32px;
  border-top: 1px solid rgba(255, 255, 255, 0.08);
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  gap: 16px;
  color: #8891ab;
  font-size: 14px;
}

.footer__brand {
  font-weight: 600;
  color: #fff;
}

.footer__links {
  display: flex;
  gap: 18px;
}

.footer__links a {
  color: inherit;
  text-decoration: none;
}

.btn {
  border: none;
  border-radius: 999px;
  padding: 12px 24px;
  font-weight: 600;
  cursor: pointer;
  transition: opacity 0.2s ease;
}

.btn:hover {
  opacity: 0.85;
}

.btn--primary {
  background: #2f5dff;
  color: #fff;
}

.btn--ghost {
  background: transparent;
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: #fff;
}

.btn--small {
  padding: 10px 18px;
  font-size: 14px;
}

@media (max-width: 768px) {
  .page {
    padding: 24px;
  }

  .hero {
    padding: 32px;
    grid-template-columns: 1fr;
    gap: 28px;
  }

  .hero__actions {
    flex-direction: column;
    width: 100%;
  }

  .hero__actions .btn {
    width: 100%;
  }

  .hero__topbar {
    position: static;
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
    pointer-events: auto;
  }

  .hero__top-actions {
    width: 100%;
    justify-content: space-between;
  }

  .hero__visual {
    order: 3;
  }

  .footer {
    flex-direction: column;
  }

  .intake__form {
    grid-template-columns: 1fr;
  }

  .intake__actions {
    flex-direction: column;
    width: 100%;
  }

  .intake__actions .btn {
    width: 100%;
  }

  .recognition {
    grid-template-columns: 1fr;
  }

  .builder__grid,
  .builder__modes,
  .checks__list,
  .testimonials__list,
  .faq__list {
    grid-template-columns: 1fr;
  }

  .experts {
    grid-template-columns: 1fr;
    gap: 18px;
  }
}

@media (max-width: 540px) {
  .page {
    padding: 20px 18px 60px;
  }

  .hero {
    padding: 28px 24px;
  }

  .hero__subtitle {
    font-size: 16px;
  }

  .intake {
    padding: 24px;
  }

  .intake__form label {
    font-size: 13px;
  }

  .demo {
    padding: 28px;
  }

  .experts {
    padding: 28px;
  }

  .faq__actions {
    flex-direction: column;
  }

  .faq__actions .btn {
    width: 100%;
  }

  .footer {
    gap: 12px;
  }
}

.editor-cta { margin: 20px auto 60px; max-width: 1100px; padding: 0 16px; }
.editor-cta__card { display: grid; grid-template-columns: 2fr 1fr; gap: 16px; align-items: center; padding: 24px; border-radius: 24px; background: linear-gradient(135deg, rgba(47,93,255,0.18), rgba(32,201,151,0.12)); border: 1px solid rgba(255,255,255,0.12); }
.editor-cta__text h2 { margin: 0 0 8px; }
.editor-cta__text p { margin: 0; color: #c7cbe0; }
.editor-cta__actions { display: flex; justify-content: flex-end; }
@media (max-width: 768px) { .editor-cta__card { grid-template-columns: 1fr; } .editor-cta__actions { justify-content: flex-start; } }
</style>